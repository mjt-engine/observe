(function(c,d){typeof exports=="object"&&typeof module<"u"?d(exports):typeof define=="function"&&define.amd?define(["exports"],d):(c=typeof globalThis<"u"?globalThis:c||self,d(c.Module={}))})(this,function(c){"use strict";const d=e=>{const t=e.split("."),n=t.shift(),r=t.join(".");return{root:n,segments:t,subpath:r}},$=e=>typeof e=="function",w=e=>e==null||Number.isNaN(e),M=e=>!w(e),v=e=>$(e)?e():e,A={isDefined:M,isUndefined:w,safe:(e,t={})=>{const{quiet:n=!1,default:r=void 0,onError:s}=t;try{return e()}catch(a){return n||(console.error(a),M(s)&&console.log(v(s))),r}}},{isDefined:f,isUndefined:C,safe:T}=A,U=(e,t,n)=>{if(C(e))return;const r=t.get(e);if(f(r))return r;if(f(n)){const s=n();return t.set(e,s),s}},D={create:()=>{const e=new Map;let t=performance.now();const n={get:(r,s)=>U(r,e,s),set:(r,s)=>(e.set(r,s),n),delete:r=>e.delete(r),entries:()=>Array.from(e.entries()),clear:()=>e.clear(),size:()=>e.size,findKeys:r=>Array.from(e.entries()).filter(([a,u])=>u===r).map(([a,u])=>a),lastUpdate:()=>t};return n}},R=e=>t=>{if(typeof e=="string"||e instanceof RegExp)return m(e,t.traceId);const{traceId:n,message:r,extra:s=()=>!0,timestamp:a=()=>!0}=e;return!(f(n)&&!m(n,t.traceId)||f(r)&&!m(r,t.message)||f(t.timestamp)&&!a(t.timestamp)||f(t.extra)&&!s(t.extra))},m=(e,t,n="m")=>typeof e=="string"?T(()=>new RegExp(e,n).test(t),{default:!1,quiet:!0}):T(()=>e.test(t),{default:!1,quiet:!0}),j=e=>t=>{for(const n of e)if(R(n)(t))return n;return!1},q=e=>t=>typeof e=="string"||e instanceof RegExp?t:e.transform?e.transform(t):t,p=e=>{const t=[],n={length:0,push:r=>{t.length>=e&&t.shift(),t.push(r),n.length=t.length},get:()=>t,clear:()=>{t.length=0,n.length=0},last:()=>t[t.length-1]};return n},h=()=>{let e=performance.now(),t;const n={end:()=>(f(t)||(t=performance.now()),n),getDuration:()=>(t??performance.now())-e};return n},S=(e=100)=>{let t=0;const n=new Map,r=new Map,s=new Map,a=p(e),u={clear:()=>(t=0,n.clear(),r.clear(),s.clear(),a.clear(),u),lastTime:()=>a.last(),time:()=>{const o=u.lastTime();f(o)&&o.end();const i=h();return a.push(i),i},getTimes:()=>a.get(),timer:o=>{const i=s.get(o)??p(e);s.set(o,i);const g=h();return i.push(g),g},increment:(o,i=1)=>{const g=n.get(o)??0;n.set(o,g+i)},gauge:(o,i=0)=>{r.set(o,i)},getCounters:()=>new Map(n),getCounter:o=>n.get(o)??0,getGauge:o=>r.get(o)??0,getGauges:()=>new Map(r),count:(o=1)=>{t+=o},getCount:()=>t,getTimers:o=>(s.get(o)??p(e)).get()};return u},b=({logMatchers:e=[],logger:t=console.log,clock:n=performance,maxSampleSize:r=100}={})=>{const s=D.create(),a={updateLogMatchers:u=>{const o=u(e);return e=o,o},getTraceIds:()=>s.entries().map(([u])=>u),start:(u,...o)=>{a.getStats(u).count(),a.getStats(u).time(),a.log({traceId:u,message:"start",extra:o})},getStats:u=>s.get(u,()=>S(r)),log:({traceId:u,message:o,timestamp:i=n.now(),extra:g=[]})=>{const L={traceId:u,message:o,timestamp:i,extra:g},O=j(e)(L);if(!O)return;const l=q(O)(L);t(`${l.timestamp} ${l.traceId}: ${l.message}`,...l.extra??[])},end:(u,...o)=>{a.getStats(u).lastTime()?.end(),a.log({traceId:u,message:"end",extra:o})}};return a},y=(e="",t=b())=>{t.start(e);const n={span:r=>y(`${e}.${r}`,t),increment:(r,s=1)=>(t.getStats(e).increment(r,s),n),sample:(r,s,a)=>{if(Math.random()<r){const u=a();n.gauge(s,u)}return n},when:(r,s,a)=>{if(r()){const u=a();n.gauge(s,u)}return n},gauge:(r,s)=>(t.getStats(e).gauge(r,s),n),timer:r=>t.getStats(e).timer(r),end:()=>(t.end(e),n),log:(r,...s)=>(t.log({traceId:e,message:r,extra:s}),n)};return n};c.Observe=y,c.ObserveAgent=b,c.Stats=S,c.Timer=h,c.parseTraceId=d,Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})});
//# sourceMappingURL=index.umd.cjs.map
